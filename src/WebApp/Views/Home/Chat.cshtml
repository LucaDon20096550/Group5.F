@model ApplicationUser
@{
    //var chats = ViewData["Chats"] as List<Chat>;
}
<div class="container mw-100">
    <div class="row" style="height: 82vh;">
        <div class="col-sm-3 col-12" style="background-color: #e2fbe8; padding: 0!important;">
            <ul class="list-group" style="border-radius: 0!important;max-height: 620px;height: 100%;overflow-y: scroll" id="chatList">
                
                <li class="list-group-item p-4" style="color: black;">
                    <a href="#">Chat verlaten</a>
                </li>


                @* @foreach (var chat2 in chats)
                {
                    @if (chat2.GetType() == typeof(PrivateChat))
                    {
                        var chat = (PrivateChat)chat2;
                        <a href="#" style="text-decoration: none;">
                            <li class="list-group-item" style="border-top: solid 1px black;">
                                <div class="row">
                                    <div class="col-4">
                                        <p>IMG</p>
                                    </div>
                                    <div class="col-8">
                                        <p>@chat.Name</p>
                                        <p>@chat.Users.Single(u => u != Model)</p>
                                        <p>@chat.Messages.Max(m => m.DateTimeSent)</p>
                                    </div>
                                </div>
                            </li>
                        </a>
                    }
                    else if (chat2.GetType() == typeof(GroupChat))
                    {
                        var chat = (GroupChat)chat2;
                        <a href="#" style="text-decoration: none;">
                            <li class="list-group-item" style="border-top: solid 1px black;">
                                <div class="row">
                                    <div class="col-4">
                                        <p>IMG</p>
                                    </div>
                                    <div class="col-8">
                                        <p>@chat.Name</p>
                                        <p>@chat.Group.Name</p>
                                        <p>@chat.Messages.Max(m => m.DateTimeSent)</p>
                                    </div>
                                </div>
                            </li>
                        </a>
                    }
                } *@

                <a href="#" style="text-decoration: none;">
                    <li class="list-group-item" style="border-top: solid 1px black;">
                        <div class="row">
                            <div class="col-4">
                                <p>IMG</p>
                            </div>
                            <div class="col-8">
                                <p>Orthopedagoog</p>
                                <p>D. Aygun</p>
                                <p>Datum</p>
                            </div>
                        </div>
                    </li>
                </a>

                <a href="#" style="text-decoration: none;">
                    <li class="list-group-item" style="border-top: solid 1px black;">
                        <div class="row">
                            <div class="col-4">
                                <p>IMG</p>
                            </div>
                            <div class="col-8">
                                <p>Orthopedagoog</p>
                                <p>D. Aygun</p>
                                <p>Datum</p>
                            </div>
                        </div>
                    </li>
                </a>

                <a href="#" style="text-decoration: none;">
                    <li class="list-group-item" style="border-top: solid 1px black;">
                        <div class="row">
                            <div class="col-4">
                                <p>IMG</p>
                            </div>
                            <div class="col-8">
                                <p>Orthopedagoog</p>
                                <p>D. Aygun</p>
                                <p>Datum</p>
                            </div>
                        </div>
                    </li>
                </a>

                <a href="#" style="text-decoration: none;">
                    <li class="list-group-item" style="border-top: solid 1px black;">
                        <div class="row">
                            <div class="col-4">
                                <p>IMG</p>
                            </div>
                            <div class="col-8">
                                <p>Orthopedagoog</p>
                                <p>D. Aygun</p>
                                <p>Datum</p>
                            </div>
                        </div>
                    </li>
                </a>

                <a href="#" style="text-decoration: none;">
                    <li class="list-group-item" style="border-top: solid 1px black;">
                        <div class="row">
                            <div class="col-4">
                                <p>IMG</p>
                            </div>
                            <div class="col-8">
                                <p>Orthopedagoog</p>
                                <p>D. Aygun</p>
                                <p>Datum</p>
                            </div>
                        </div>
                    </li>
                </a>
            </ul>
        </div>
        <div class="col-9 d-none d-sm-block" style="display: flex!important;background-color: #e2fbe8;padding: 0!important;flex-direction: column;justify-content: space-between;">
            <div class="col-12" style="padding: 0;">

                <ul class="list-group" style="overflow-y: scroll;list-style-type: none;max-height:450px;">

                    <li style="margin: 25px;">
                        <p style="margin: 5px;font-size: 14px;">Orthopedagoog, D. Aygun</p>
                        <div style="max-width: 250px;min-width:250px;padding: 15px;background-color: #BBE1C3;border-radius: 15px;">
                            <p style="margin:0;">We hebben een afspraak om 2 uur.</p>
                        </div>
                    </li>

                    <li style="margin: 25px;margin-left: auto;">
                        <p style="margin: 5px;font-size: 14px;">Karel Van Appel</p>
                        <div style="max-width: 250px;min-width:250px;padding: 15px;background-color: #BBE1C3;border-radius: 15px;">
                            <p style="margin:0;">Ja, ik ben er!</p>
                        </div>
                    </li>

                    <li style="margin: 25px;">
                        <p style="margin: 5px;font-size: 14px;">Orthopedagoog, D. Aygun</p>
                        <div style="max-width: 250px;min-width:250px;padding: 15px;background-color: #BBE1C3;border-radius: 15px;">
                            <p style="margin:0;">Prima.</p>
                        </div>
                    </li>

                                        <li style="margin: 25px;">
                        <p style="margin: 5px;font-size: 14px;">Orthopedagoog, D. Aygun</p>
                        <div style="max-width: 250px;min-width:250px;padding: 15px;background-color: #BBE1C3;border-radius: 15px;">
                            <p style="margin:0;">Prima.</p>
                        </div>
                    </li>

                </ul>

            </div>
            <div class="col-12" style="height: 150px; background-color: white;">
                <form class="h-100" action="/" method="post">

                <div class="row h-100">
                    <div class="col-10">
                        <textarea class="h-100 w-100" style="padding: 10px;resize:none;border:none;" type="textarea" name="bericht"
                         placeholder="Bericht..."></textarea>
                    </div>
                    
                    <div class="col-2 h-100" style="display: flex;flex-direction: column;justify-content: flex-end;">
                        <input type="submit" value="Verstuur" style="border: none;background-color: #BBE1C3;color: white;padding: 10px;"> 
                    </div>
                </div>
                                       
                </form>
            </div>

        </div>
    </div>
</div>

@section Scripts {
    <script>
        setInterval(updateChat(), 1000);

        var chats = [];

        async function updateChat() {
            const list = await fetch("/api/ChatApi")
                .then((i) => i.json);

            var chatUpdated = false;
            alert("test");
            if (list.length != chats.length) { chatUpdated = true; }
            else {
                for (let i = 0; i < list.length(); i++) {
                    if (list[i] != chats[i]) { chatUpdated = true; }
                }
            }
            //if (chatUpdated) {
                chats = list;
                var chatList = document.getElementById("chatList");
                chatList.innerHTML = "<li class=\"list-group-item p-4\" style=\"color: black;\"><a href=\"#\">Chat verlaten</a></li>";
                for (var chat2 of chats)
                {
                    @if (@:chat2.GetType() == typeof(PrivateChat))
                    {
                        var chat = (PrivateChat)chat2;
                        @:chatList.innerHTML += "<a href=\"#\" style=\"text-decoration: none;\">" +
                        @:    "<li class=\"list-group-item\" style=\"border-top: solid 1px black;\">" +
                        @:        "<div class=\"row\">" +
                        @:            "<div class=\"col-4\">" +
                        @:                "<p>IMG</p>" +
                        @:            "</div>" +
                        @:            "<div class=\"col-8\">" +
                        @:                "<p>" + @chat.Name + "</p>" +
                        @:                "<p>" + @chat.Users.Single(u => u != Model) + "</p>" +
                        @:                "<p>" + @chat.Messages.Max(m => m.DateTimeSent) + "</p>" +
                        @:            "</div>" +
                        @:        "</div>" +
                        @:    "</li>" +
                        @:"</a>";
                    }
                    else if (chat2.GetType() == typeof(GroupChat))
                    {
                        var chat = (GroupChat)chat2;
                        @:chatList.innerHTML += "<a href=\"#\" style=\"text-decoration: none;\">" +
                        @:    "<li class=\"list-group-item\" style=\"border-top: solid 1px black;\">" +
                        @:        "<div class=\"row\">" +
                        @:            "<div class=\"col-4\">" +
                        @:                "<p>IMG</p>" +
                        @:            "</div>" +
                        @:            "<div class=\"col-8\">" +
                        @:                "<p>" + @chat.Name + "</p>" +
                        @:                "<p>" + @chat.Group.Name + "</p>" +
                        @:                "<p>" + @chat.Messages.Max(m => m.DateTimeSent) + "</p>" +
                        @:            "</div>" +
                        @:        "</div>" +
                        @:    "</li>" +
                        @:"</a>";
                    }
                }
            //}
        }
    </script>
}